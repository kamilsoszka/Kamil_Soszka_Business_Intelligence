{
  "name": "Units Sold Color Optimized",
  "expression": [
    "",
    "/*",
    "    Business Goal: This measure returns a color code (hex) based on the Year-over-Year (YoY)",
    "    change in Units Sold. It is designed for conditional formatting in reports to visually",
    "    indicate volume performance trends - green for volume growth, red for volume decline,",
    "    and gray for no change. The measure returns a text value suitable for font color,",
    "    background color, or icon conditional formatting in various visualizations.",
    "",
    "    Function Explanation:",
    "    VAR: Used to declare variables that store intermediate calculation results.",
    "    This improves performance and code readability by calculating values once.",
    "*/",
    "VAR Current_Units_Sold = ",
    "    /*",
    "        IFERROR: Evaluates the [Units Sold] measure and returns it if no error occurs.",
    "        If an error is encountered, it returns BLANK() instead.",
    "        This ensures the measure handles calculation errors gracefully without breaking",
    "        and maintains data cleanliness.",
    "    */",
    "    IFERROR( [Units Sold], BLANK() )",
    "",
    "VAR Previous_Year_Units_Sold =",
    "    /*",
    "        CALCULATE: Modifies the filter context for the [Units Sold] measure evaluation.",
    "        SAMEPERIODLASTYEAR: A time intelligence function that takes a date column",
    "        and returns a set of dates from the previous year corresponding to the current",
    "        date context. For example, if viewing March 2024, it returns dates for March 2023.",
    "        This enables accurate year-over-year comparisons for volume performance.",
    "    */",
    "    CALCULATE (",
    "        IFERROR( [Units Sold], BLANK() ),",
    "        SAMEPERIODLASTYEAR ( 'Dates Optimized'[Date] )",
    "    )",
    "",
    "// Calculates the absolute Year-over-Year Change: Current Period - Previous Year",
    "VAR YoY_Change_Absolute = ",
    "    /*",
    "        COALESCE: Returns the first expression that does not evaluate to BLANK.",
    "        Here, it replaces BLANK values with 0 to ensure correct arithmetic operations",
    "        in the subtraction. This prevents calculation errors when either current or",
    "        previous year units sold data is missing.",
    "    */",
    "    COALESCE( Current_Units_Sold, 0 ) - COALESCE( Previous_Year_Units_Sold, 0 )",
    "",
    "RETURN",
    "    /*",
    "        SWITCH: Evaluates multiple conditions and returns one of several result expressions.",
    "        TRUE(): Used as the first argument to enable conditional logic based on the value",
    "        of YoY_Change_Absolute. This structure checks each condition in sequence.",
    "    */",
    "    SWITCH (",
    "        TRUE(),",
    "        // Condition 1: Units Sold increased (Green) - Favorable volume performance",
    "        YoY_Change_Absolute > 0, \"#00A650\", ",
    "        // Condition 2: Units Sold decreased (Red) - Unfavorable volume performance",
    "        YoY_Change_Absolute < 0, \"#E60000\", ",
    "        // Condition 3: No change, zero, or BLANK (Gray) - Neutral volume performance",
    "        \"#7F8C8D\" ",
    "    )"
  ],
  "displayFolder": "units sold",
  "lineageTag": "7e16cb3f-7074-4c3f-8370-cb11bf607d4d"
}