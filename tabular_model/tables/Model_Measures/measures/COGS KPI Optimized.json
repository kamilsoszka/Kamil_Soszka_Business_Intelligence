{
  "name": "COGS KPI Optimized",
  "expression": [
    "",
    "/*",
    "    Business Goal: Constructs a concise text-formatted KPI indicator.",
    "    It displays the previous year's COGS value (PY Value), the YoY change direction",
    "    (arrow symbol), and the percentage change in COGS YoY.",
    "    This measure is designed for use in card visuals or KPIs to provide a quick,",
    "    comprehensive view of performance compared to the previous year.",
    "*/",
    "VAR Current_COGS = ",
    "    /*",
    "        Retrieves the COGS value for the current filter context.",
    "        This variable calls the base [COGS] measure.",
    "    */",
    "    [COGS]",
    "VAR Previous_Year_COGS =",
    "    /*",
    "        Calculates the COGS for the same period in the previous year.",
    "        CALCULATE: Modifies the filter context for the [COGS] measure.",
    "        SAMEPERIODLASTYEAR: A time intelligence function that returns a set of dates",
    "        from the previous year corresponding to the current date context.",
    "        This is the standard and most accurate method for YoY comparisons.",
    "    */",
    "    CALCULATE ( ",
    "        [COGS], ",
    "        SAMEPERIODLASTYEAR ( 'Dates Optimized'[Date] ) ",
    "    )",
    "VAR Change_Percentage =",
    "    /*",
    "        Calculates the Year-over-Year percentage change in COGS.",
    "        DIVIDE: Safely performs division and handles division by zero errors.",
    "        - First argument: Numerator (Current - Previous)",
    "        - Second argument: Denominator (Previous Year value)",
    "        - Third argument: Alternative result in case of error (e.g., division by zero)",
    "    */",
    "    DIVIDE (",
    "        Current_COGS - Previous_Year_COGS,",
    "        Previous_Year_COGS,",
    "        BLANK () // Returns BLANK instead of an error if dividing by zero",
    "    )",
    "VAR Is_Change_Positive = ",
    "    /*",
    "        Creates a logical (TRUE/FALSE) variable indicating if the change was positive.",
    "        This variable improves code readability for the subsequent IF statement.",
    "        A positive change means COGS increased (which is typically unfavorable).",
    "    */",
    "    Change_Percentage > 0",
    "VAR Arrow_Symbol =",
    "    /*",
    "        Assigns an arrow symbol based on the direction of the change.",
    "        IF: Returns one of two values based on a logical condition.",
    "        UNICHAR: Returns the Unicode character for the specified number.",
    "        - 11165: Upwards arrow (↑) - indicates an increase in COGS (unfavorable)",
    "        - 11167: Downwards arrow (↓) - indicates a decrease in COGS (favorable)",
    "    */",
    "    IF (",
    "        Is_Change_Positive,",
    "        UNICHAR ( 11165 ), // Up arrow for increase",
    "        UNICHAR ( 11167 )  // Down arrow for decrease/no change",
    "    )",
    "RETURN",
    "    /*",
    "        Final conditional check to determine if the KPI should be displayed.",
    "        IF: Checks if there's a valid percentage change to display.",
    "        ISBLANK: Returns TRUE if the Change_Percentage is BLANK.",
    "        This prevents displaying the KPI when there's no data (e.g., first year of data).",
    "    */",
    "    IF (",
    "        ISBLANK ( Change_Percentage ),",
    "        BLANK (),",
    "        /*",
    "            Constructs the final KPI string by concatenating multiple elements:",
    "            - \"PY \": Literal text prefix",
    "            - FORMAT(Previous_Year_COGS, \"#,,#,,.00M\"): Formats the previous year value",
    "              in millions with two decimal places (e.g., 1.50M)",
    "            - Arrow_Symbol: The directional arrow",
    "            - FORMAT(Change_Percentage, \"0.00%\"): Formats the percentage change as",
    "              a percentage with two decimal places (e.g., 15.25%)",
    "        */",
    "        \"PY \" & FORMAT ( Previous_Year_COGS, \"#,,#,,.00M\" ) & \" \" & Arrow_Symbol & \" \"",
    "            & FORMAT ( Change_Percentage, \"0.00%\" )",
    "    )"
  ],
  "displayFolder": "cogs",
  "lineageTag": "7f1b15af-6d92-431c-8797-54bf787e5a4c"
}