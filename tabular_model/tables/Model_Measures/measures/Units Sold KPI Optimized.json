{
  "name": "Units Sold KPI Optimized",
  "expression": [
    "",
    "/*",
    "    Business Goal: Constructs a concise text-formatted KPI indicator that displays:",
    "    - Previous Year's Units Sold value (PY Value) formatted in millions",
    "    - Year-over-Year change direction (arrow symbol)",
    "    - Percentage change in Units Sold YoY",
    "    ",
    "    This measure is designed for use in card visuals, KPIs, or table headers to provide",
    "    a quick, comprehensive view of sales volume performance compared to the previous year.",
    "    The output format is: \"PY 1.50M ↑ 15.25%\"",
    "",
    "    Function Explanation:",
    "    VAR: Used to declare variables that store intermediate calculation results.",
    "    This improves performance and code readability by calculating values once.",
    "*/",
    "VAR Current_Units_Sold = ",
    "    /*",
    "        Retrieves the Units Sold value for the current filter context.",
    "        This variable calls the base [Units Sold] measure.",
    "    */",
    "    [Units Sold]",
    "VAR Previous_Year_Units_Sold =",
    "    /*",
    "        Calculates the Units Sold for the same period in the previous year.",
    "        CALCULATE: Modifies the filter context for the [Units Sold] measure.",
    "        SAMEPERIODLASTYEAR: A time intelligence function that returns a set of dates",
    "        from the previous year corresponding to the current date context.",
    "        This is the recommended best practice for accurate YoY volume comparisons.",
    "    */",
    "    CALCULATE ( ",
    "        [Units Sold], ",
    "        SAMEPERIODLASTYEAR ( 'Dates Optimized'[Date] ) ",
    "    )",
    "VAR Change_Percentage =",
    "    /*",
    "        Calculates the Year-over-Year percentage change in Units Sold.",
    "        DIVIDE: Safely performs division and handles division by zero errors.",
    "        - First argument: Numerator (Current - Previous)",
    "        - Second argument: Denominator (Previous Year value)",
    "        - Third argument: Alternative result in case of error (BLANK here)",
    "    */",
    "    DIVIDE (",
    "        Current_Units_Sold - Previous_Year_Units_Sold,",
    "        Previous_Year_Units_Sold,",
    "        BLANK () // Safe handling of division by zero",
    "    )",
    "VAR Is_Units_Increased = ",
    "    /*",
    "        Creates a logical (TRUE/FALSE) variable indicating if units sold increased.",
    "        A positive change percentage means sales volume grew compared to previous year.",
    "    */",
    "    Change_Percentage > 0",
    "VAR Arrow_Symbol =",
    "    /*",
    "        Assigns an arrow symbol based on the direction of the volume change.",
    "        IF: Returns one of two values based on a logical condition.",
    "        UNICHAR: Returns the Unicode character for the specified number.",
    "        - 11165: Upwards arrow (↑) - indicates volume increase (favorable)",
    "        - 11167: Downwards arrow (↓) - indicates volume decrease (unfavorable)",
    "        ",
    "        This follows standard business conventions where sales volume growth is positive",
    "        and represented by an upward arrow.",
    "    */",
    "    IF (",
    "        Is_Units_Increased,",
    "        UNICHAR ( 11165 ), // Up arrow for volume increase (good)",
    "        UNICHAR ( 11167 )  // Down arrow for volume decrease/no change (bad)",
    "    )",
    "RETURN",
    "    /*",
    "        Final conditional check to determine if the KPI should be displayed.",
    "        IF: Checks if there's a valid percentage change to display.",
    "        ISBLANK: Returns TRUE if the Change_Percentage is BLANK.",
    "        This prevents displaying the KPI when there's no data for comparison",
    "        (e.g., first year of data or missing previous year values).",
    "    */",
    "    IF (",
    "        ISBLANK ( Change_Percentage ),",
    "        BLANK (),",
    "        /*",
    "            Constructs the final KPI string by concatenating multiple elements:",
    "            - \"PY \": Literal text prefix for Previous Year",
    "            - FORMAT(Previous_Year_Units_Sold, \"#,,#,,.00M\"): Formats the previous year value",
    "              in millions with two decimal places using thousand separators",
    "              (e.g., 1.50M for 1,500,000 units)",
    "            - Arrow_Symbol: The directional arrow (↑ or ↓)",
    "            - FORMAT(Change_Percentage, \"0.00%\"): Formats the percentage change as",
    "              a percentage with two decimal places (e.g., 15.25%)",
    "        */",
    "        \"PY \" & FORMAT ( Previous_Year_Units_Sold, \"#,,#,,.00M\" ) & \" \" & Arrow_Symbol & \" \"",
    "            & FORMAT ( Change_Percentage, \"0.00%\" )",
    "    )"
  ],
  "displayFolder": "units sold",
  "lineageTag": "78cd1772-542e-412e-94a7-3fb44c157938"
}